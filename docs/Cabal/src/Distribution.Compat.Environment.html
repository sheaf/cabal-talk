<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_HADDOCK hide #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Distribution.Compat.Environment</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Distribution.Compat.Environment.html#getEnvironment"><span class="hs-identifier">getEnvironment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lookupEnv</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Distribution.Compat.Environment.html#setEnv"><span class="hs-identifier">setEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsetEnv</span></span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file://C:\Docs\Code\Haskell\cabal\dist-newstyle\build\x86_64-windows\ghc-9.6.3\Cabal-syntax-3.13.0.0\doc\html\Cabal-syntax\src/Distribution.Compat.Prelude.html"><span class="hs-identifier">Distribution.Compat.Prelude</span></a></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lookupEnv</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsetEnv</span></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">System.Environment</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">System</span></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Distribution.Compat.Stack.html"><span class="hs-identifier">Distribution.Compat.Stack</span></a></span><span class="hs-cpp">

#ifdef mingw32_HOST_OS
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C</span></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Windows</span></span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C.Types</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C.String</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C.Error</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">throwErrnoIfMinus1_</span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Posix.Internals</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">withFilePath</span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#endif /* mingw32_HOST_OS */
</span><span>
</span><span id="line-28"></span><span class="annot"><a href="Distribution.Compat.Environment.html#getEnvironment"><span class="hs-identifier hs-type">getEnvironment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-cpp">
#ifdef mingw32_HOST_OS
</span><span class="hs-comment">-- On Windows, the names of environment variables are case-insensitive, but are</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- often given in mixed-case (e.g. &quot;PATH&quot; is &quot;Path&quot;), so we have to normalise</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- them.</span><span>
</span><span id="line-33"></span><span id="getEnvironment"><span class="annot"><span class="annottext">getEnvironment :: IO [(String, String)]
</span><a href="Distribution.Compat.Environment.html#getEnvironment"><span class="hs-identifier hs-var hs-var">getEnvironment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(String, String)] -&gt; [(String, String)])
-&gt; IO [(String, String)] -&gt; IO [(String, String)]
forall a b. (a -&gt; b) -&gt; IO a -&gt; IO b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[(String, String)] -&gt; [(String, String)]
forall {b}. [(String, b)] -&gt; [(String, b)]
</span><a href="#local-6989586621679401046"><span class="hs-identifier hs-var">upcaseVars</span></a></span><span> </span><span class="annot"><span class="annottext">IO [(String, String)]
</span><span class="hs-identifier hs-var">System.getEnvironment</span></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>    </span><span id="local-6989586621679401046"><span class="annot"><span class="annottext">upcaseVars :: [(String, b)] -&gt; [(String, b)]
</span><a href="#local-6989586621679401046"><span class="hs-identifier hs-var hs-var">upcaseVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, b) -&gt; (String, b)) -&gt; [(String, b)] -&gt; [(String, b)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(String, b) -&gt; (String, b)
forall {b}. (String, b) -&gt; (String, b)
</span><a href="#local-6989586621679401048"><span class="hs-identifier hs-var">upcaseVar</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span id="local-6989586621679401048"><span class="annot"><span class="annottext">upcaseVar :: (String, b) -&gt; (String, b)
</span><a href="#local-6989586621679401048"><span class="hs-identifier hs-var hs-var">upcaseVar</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679401049"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401049"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679401050"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679401050"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><span class="hs-identifier hs-var">toUpper</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401049"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679401050"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-identifier">getEnvironment</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">System.getEnvironment</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- | @setEnv name value@ sets the specified environment variable to @value@.</span><span>
</span><span id="line-42"></span><span class="hs-comment">--</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- Throws `Control.Exception.IOException` if either @name@ or @value@ is the</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- empty string or contains an equals sign.</span><span>
</span><span id="line-45"></span><span class="annot"><a href="Distribution.Compat.Environment.html#setEnv"><span class="hs-identifier hs-type">setEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span id="setEnv"><span class="annot"><span class="annottext">setEnv :: String -&gt; String -&gt; IO ()
</span><a href="Distribution.Compat.Environment.html#setEnv"><span class="hs-identifier hs-var hs-var">setEnv</span></a></span></span><span> </span><span id="local-6989586621679401052"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401052"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621679401053"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401053"><span class="hs-identifier hs-var">value_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="Distribution.Compat.Environment.html#setEnv_"><span class="hs-identifier hs-var">setEnv_</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401052"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401055"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-47"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-comment">-- NOTE: Anything that follows NUL is ignored on both POSIX and Windows. We</span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-comment">-- still strip it manually so that the null check above succeeds if a value</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-comment">-- starts with NUL.</span><span>
</span><span id="line-51"></span><span>    </span><span id="local-6989586621679401055"><span class="annot"><span class="annottext">value :: String
</span><a href="#local-6989586621679401055"><span class="hs-identifier hs-var hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; String -&gt; String
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">takeWhile</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\NUL'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401053"><span class="hs-identifier hs-var">value_</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="annot"><a href="Distribution.Compat.Environment.html#setEnv_"><span class="hs-identifier hs-type">setEnv_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">

#ifdef mingw32_HOST_OS
</span><span>
</span><span id="line-57"></span><span id="setEnv_"><span class="annot"><span class="annottext">setEnv_ :: String -&gt; String -&gt; IO ()
</span><a href="Distribution.Compat.Environment.html#setEnv_"><span class="hs-identifier hs-var hs-var">setEnv_</span></a></span></span><span> </span><span id="local-6989586621679401060"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401060"><span class="hs-identifier hs-var">key</span></a></span></span><span> </span><span id="local-6989586621679401061"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401061"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (CWString -&gt; IO ()) -&gt; IO ()
forall a. String -&gt; (CWString -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withCWString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401060"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">((CWString -&gt; IO ()) -&gt; IO ()) -&gt; (CWString -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679401063"><span class="annot"><span class="annottext">CWString
</span><a href="#local-6989586621679401063"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (CWString -&gt; IO ()) -&gt; IO ()
forall a. String -&gt; (CWString -&gt; IO a) -&gt; IO a
</span><span class="hs-identifier hs-var">withCWString</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679401061"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">((CWString -&gt; IO ()) -&gt; IO ()) -&gt; (CWString -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679401064"><span class="annot"><span class="annottext">CWString
</span><a href="#local-6989586621679401064"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-58"></span><span>  </span><span id="local-6989586621679401065"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679401065"><span class="hs-identifier hs-var">success</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CWString -&gt; CWString -&gt; IO Bool
</span><a href="Distribution.Compat.Environment.html#c_SetEnvironmentVariable"><span class="hs-identifier hs-var">c_SetEnvironmentVariable</span></a></span><span> </span><span class="annot"><span class="annottext">CWString
</span><a href="#local-6989586621679401063"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">CWString
</span><a href="#local-6989586621679401064"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679401065"><span class="hs-identifier hs-var">success</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IO ()
forall a. String -&gt; IO a
</span><span class="hs-identifier hs-var">throwGetLastError</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;setEnv&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="annottext">CallStack
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CallStack
HasCallStack =&gt; CallStack
</span><span class="hs-identifier hs-var">callStack</span></span><span> </span><span class="hs-comment">-- TODO: attach CallStack to exception</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-comment">{- FOURMOLU_DISABLE -}</span><span class="hs-cpp">
# if defined(i386_HOST_ARCH)
</span><span class="hs-cpp">#  define WINDOWS_CCONV stdcall
</span><span class="hs-cpp"># elif defined(x86_64_HOST_ARCH)
</span><span class="hs-cpp">#  define WINDOWS_CCONV ccall
</span><span class="hs-cpp"># else
</span><span class="hs-cpp">#  error Unknown mingw32 arch
</span><span class="hs-cpp"># endif /* i386_HOST_ARCH */
</span><span>
</span><span id="line-72"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">WINDOWS_CCONV</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;windows.h SetEnvironmentVariableW&quot;</span><span>
</span><span id="line-73"></span><span>  </span><span id="c_SetEnvironmentVariable"><span class="annot"><a href="Distribution.Compat.Environment.html#c_SetEnvironmentVariable"><span class="hs-identifier hs-var">c_SetEnvironmentVariable</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LPTSTR</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LPTSTR</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Prelude.IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-cpp">
#else
</span><span class="hs-identifier">setEnv_</span><span> </span><span class="hs-identifier">key</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-76"></span><span>  </span><span class="hs-identifier">withFilePath</span><span> </span><span class="hs-identifier">key</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">keyP</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-identifier">withFilePath</span><span> </span><span class="hs-identifier">value</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-identifier">valueP</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-78"></span><span>      </span><span class="hs-identifier">throwErrnoIfMinus1_</span><span> </span><span class="hs-string">&quot;setenv&quot;</span><span> </span><span class="hs-operator">$</span><span>
</span><span id="line-79"></span><span>        </span><span class="hs-identifier">c_setenv</span><span> </span><span class="hs-identifier">keyP</span><span> </span><span class="hs-identifier">valueP</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">True</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">callStack</span><span> </span><span class="hs-comment">-- TODO: attach CallStack to exception</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;setenv&quot;</span><span>
</span><span id="line-84"></span><span>   </span><span class="hs-identifier">c_setenv</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Prelude.IO</span><span> </span><span class="hs-identifier">CInt</span><span class="hs-cpp">
#endif /* mingw32_HOST_OS */
</span><span class="hs-comment">{- FOURMOLU_ENABLE -}</span><span>
</span><span id="line-87"></span></pre></body></html>